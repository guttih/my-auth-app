== üõ†Ô∏è Setup Instructions for `my-auth-app`

This guide installs all required tools and runs the Next.js + PostgreSQL + NextAuth + Prisma app.

---

=== ‚úÖ 1. Install System Requirements

==== Ubuntu / Debian
[source,bash]
----
sudo apt update
sudo apt install nodejs npm postgresql postgresql-contrib
----

Optional (if node version is too old):
[source,bash]
----
sudo npm install -g n
sudo n latest
----

==== Fedora / Rocky linux

===== Manually on windows wsl - fedora

[source,bash]
----
sudo dnf install nodejs npm postgresql postgresql-contrib postgresql-server
sudo -u postgres initdb -D /var/lib/pgsql/data --auth=peer --auth-host=md5
sudo systemctl enable --now postgresql
----

=== ‚úÖ 2. Create PostgreSQL User and Database

[source,bash]
----
sudo -i -u postgres
psql
----

In the psql prompt:
[source,sql]
----
CREATE USER guttih WITH PASSWORD 'hunter2';
CREATE DATABASE guttihdb OWNER guttih;
ALTER ROLE guttih CREATEDB;
\q
----


==== Configure Environment Variables
Create a .env file in the project root with your database connection string:
[source,bash]
----
touch .env
----
Then edit .env to include the line

[source,env]
----
DATABASE_URL="postgresql://guttih:hunter2@localhost:5432/guttihdb"
----
Replace `guttih` and `hunter2` with your actual PostgreSQL username and password, if different.

Test the connection string as user postgres
[source,bash]
----
sudo -u postgres
psql "postgresql://guttih:hunter2@localhost:5432/guttihdb" -c "select current_user, current_database();"

----


---

=== ‚úÖ 3. Install Node.js Packages

[source,bash]
----
# Runtime dependencies ‚Äî needed in both development and production
npm install

npx prisma migrate dev --name init
npx tsx prisma/seed.ts
npm i -D prisma # dev dependency
npx prisma generate

----

Gotchas to avoid:
- npx tsx prisma/seed.ts ‚Üí ‚ùå This needs tsx and tsconfig.json, so only run it before deploying.
- Don't forget .env on the server ‚Äî your app will fail without DATABASE_URL.

and create a **.env.local** file with someting like this:
[source,env]
----
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=kmLumZtBmGIMkJhANnbjeAI4vPrWs78peWawyQip7U4=
DISABLE_PASSWORD_WHEN_LINKED_ACCOUNT=false
AUTH_CREDENTIALS_ENABLED=false
---

If you want to allow microsoft and/or google login, add these to your .env.local:

For Microsoft (Azure AD / Entra):
[source,env]
----
AZURE_AD_CLIENT_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
AZURE_AD_CLIENT_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
AZURE_AD_TENANT_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
----

For Google:
[source,env]
----
GOOGLE_CLIENT_ID=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
----

for production create a **.env.production** file with the same content as .env.local, but with `ALLOW_PASSWORD_WHEN_OAUTH=false` to disable password login when OAuth is enabled.

=== ‚úÖ 4. Run the App

[source,bash]
----
npm run dev
----

Then open: http://localhost:3000/login[http://localhost:3000/login]

Login credentials:

- *Email:* `admin@guttih.com`
- *Password:* `hunter2`

---

=== ‚úÖ 5. Optional: Browse DB in Prisma Studio

[source,bash]
----
npx prisma studio
----

Opens a UI at http://localhost:5555[http://localhost:5555]

---

=== üí• Setup is Complete!
